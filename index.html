<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orion Gen | 2.0 Flash Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@zip-js/zip-js@2.7.34/dist/zip.min.js"></script>
    <style>
        [x-cloak] { display: none !important; }
        body {
            background: radial-gradient(circle at top right, #0f172a, #020617);
            min-height: 100vh;
            color: #f8fafc;
            font-family: system-ui, -apple-system, sans-serif;
        }
        .glass {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        ::view-transition-old(root), ::view-transition-new(root) { animation-duration: 0.4s; }
        iframe { border-radius: 12px; background: #fff; }
    </style>
</head>
<body x-data="orionApp()" x-cloak>

    <nav class="glass sticky top-0 z-50 px-4 py-3 flex justify-between items-center border-b border-white/5">
        <div class="flex items-center space-x-2">
            <div class="w-7 h-7 bg-blue-500 rounded flex items-center justify-center font-bold rotate-12">O</div>
            <span class="font-bold tracking-tight text-lg">ORION <span class="text-blue-400">FLASH</span></span>
        </div>
        <button @click="showSettings = true" class="p-2 bg-white/5 rounded-full">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path></svg>
        </button>
    </nav>

    <main class="p-4 max-w-6xl mx-auto space-y-4">
        <section class="glass rounded-2xl p-5 space-y-4">
            <div>
                <label class="text-[10px] font-bold text-blue-400 uppercase tracking-widest">Brainstorming & Concept</label>
                <textarea x-model="prompt" class="w-full bg-black/30 border border-white/10 rounded-xl p-3 mt-1 text-sm h-28 focus:ring-1 focus:ring-blue-500 outline-none" placeholder="What should we build today?"></textarea>
            </div>
            
            <div class="grid grid-cols-2 gap-3">
                <div>
                    <label class="text-[10px] font-bold text-gray-400 uppercase">Theme</label>
                    <select x-model="selectedTheme" class="w-full bg-black/30 border border-white/10 rounded-lg p-2 text-xs mt-1 outline-none">
                        <option value="modern-minimalist">Minimalist</option>
                        <option value="glass-morphism">Liquid Glass</option>
                        <option value="cyberpunk">Cyberpunk</option>
                        <option value="classic-luxury">Luxury</option>
                    </select>
                </div>
                <button @click="generate()" :disabled="loading" class="bg-blue-600 hover:bg-blue-500 rounded-lg font-bold text-sm transition-all disabled:opacity-50 mt-5">
                    <span x-show="!loading">Generate</span>
                    <span x-show="loading" class="animate-pulse">Flash-Sync...</span>
                </button>
            </div>
        </section>

        <section class="glass rounded-2xl overflow-hidden flex flex-col h-[500px]">
            <div class="bg-black/40 px-4 py-2 flex justify-between items-center border-b border-white/5">
                <span class="text-[10px] font-mono text-gray-500">2026.PREVIEW_RENDER</span>
                <div class="flex space-x-2">
                    <button @click="download()" class="text-[10px] bg-white/5 px-2 py-1 rounded">ZIP</button>
                    <button @click="deploy()" :disabled="!isReady" class="text-[10px] bg-green-600 px-2 py-1 rounded disabled:opacity-30">DEPLOY</button>
                </div>
            </div>
            <iframe class="flex-1 w-full" :srcdoc="html"></iframe>
        </section>

        <section class="glass rounded-xl p-3 max-h-32 overflow-y-auto font-mono text-[10px] text-gray-400">
            <template x-for="log in logs">
                <div class="mb-1"><span class="text-blue-500">â†’</span> <span x-text="log"></span></div>
            </template>
        </section>
    </main>

    <div x-show="showSettings" class="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80 backdrop-blur-md">
        <div class="glass w-full max-w-sm rounded-3xl p-6 border border-white/20">
            <h2 class="text-xl font-bold mb-4">Keys</h2>
            <div class="space-y-4">
                <input type="password" x-model="config.geminiKey" placeholder="Gemini 2.0 Flash Key" class="w-full bg-black/40 border border-white/10 rounded-lg p-3 text-sm">
                <input type="password" x-model="config.githubPat" placeholder="GitHub Fine-grained PAT" class="w-full bg-black/40 border border-white/10 rounded-lg p-3 text-sm">
                <input type="text" x-model="config.gasUrl" placeholder="GAS Webhook URL" class="w-full bg-black/40 border border-white/10 rounded-lg p-3 text-sm">
            </div>
            <button @click="save()" class="w-full mt-6 bg-blue-600 py-3 rounded-xl font-bold">Save & Close</button>
        </div>
    </div>

    <script>
        function orionApp() {
            return {
                prompt: '', html: '<html><body style="background:#0f172a;color:#475569;display:flex;justify-content:center;align-items:center;height:100vh;font-family:sans-serif">Waiting for Flash Synthesis...</body></html>',
                loading: false, isReady: false, showSettings: false, logs: ['System standby.'], selectedTheme: 'glass-morphism',
                config: { 
                    geminiKey: localStorage.getItem('g_key') || '', 
                    githubPat: localStorage.getItem('gh_pat') || '', 
                    gasUrl: localStorage.getItem('gas_url') || '' 
                },
                save() { 
                    localStorage.setItem('g_key', this.config.geminiKey);
                    localStorage.setItem('gh_pat', this.config.githubPat);
                    localStorage.setItem('gas_url', this.config.gasUrl);
                    this.showSettings = false; 
                    this.logs.unshift('Config updated.');
                },
                async generate() {
                    if(!this.config.geminiKey) return (this.showSettings = true);
                    this.loading = true; this.logs.unshift('Gemini 2.0 Flash thinking...');
                    
                    const systemPrompt = `Act as a 2026 Senior Architect. Create a single-file HTML/Tailwind4/Alpine.js app for: ${this.prompt}. Theme: ${this.selectedTheme}. Use Bento Grid and View Transitions. Return ONLY raw HTML code.`;
                    
                    try {
                        const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${this.config.geminiKey}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ contents: [{ parts: [{ text: systemPrompt }] }] })
                        });
                        const data = await res.json();
                        const raw = data.candidates[0].content.parts[0].text;
                        this.html = raw.replace(/```html|```/g, '');
                        this.isReady = true;
                        this.logs.unshift('App synthesized successfully.');
                        this.sync();
                    } catch (e) { this.logs.unshift('Error: ' + e.message); }
                    finally { this.loading = false; }
                },
                async deploy() {
                    if(!this.config.githubPat) return (this.showSettings = true);
                    this.logs.unshift('Deploying to GitHub Pages...');
                    const name = `flash-app-${Date.now()}`;
                    const headers = { 'Authorization': `Bearer ${this.config.githubPat}`, 'Content-Type': 'application/json' };
                    
                    try {
                        const repo = await fetch('https://api.github.com/user/repos', { method: 'POST', headers, body: JSON.stringify({ name }) }).then(r => r.json());
                        await fetch(`https://api.github.com/repos/${repo.owner.login}/${name}/contents/index.html`, {
                            method: 'PUT', headers, body: JSON.stringify({ message: 'deploy', content: btoa(unescape(encodeURIComponent(this.html))) })
                        });
                        this.logs.unshift('Waiting 15s for propagation...');
                        await new Promise(r => setTimeout(r, 15000));
                        await fetch(`https://api.github.com/repos/${repo.owner.login}/${name}/pages`, { 
                            method: 'POST', headers: { ...headers, 'Accept': 'application/vnd.github.v3+json' }, body: JSON.stringify({ source: { branch: 'main', path: '/' } }) 
                        });
                        this.logs.unshift(`LIVE: https://${repo.owner.login}.github.io/${name}/`);
                        window.open(`https://${repo.owner.login}.github.io/${name}/`, '_blank');
                    } catch (e) { this.logs.unshift('Deploy failed.'); }
                },
                async download() {
                    const writer = new zip.ZipWriter(new zip.BlobWriter("application/zip"));
                    await writer.add("index.html", new zip.TextReader(this.html));
                    const blob = await writer.close();
                    const a = document.createElement("a");
                    a.href = URL.createObjectURL(blob); a.download = "orion-flash-app.zip"; a.click();
                },
                async sync() {
                    if(!this.config.gasUrl) return;
                    fetch(this.config.gasUrl, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ prompt: this.prompt, date: new Date() }) });
                }
            }
        }
    </script>
</body>
</html>
